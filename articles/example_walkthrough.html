<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Walkthrough of waiting list functions • NHSRwaitinglist</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Walkthrough of waiting list functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NHSRwaitinglist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.9999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example_walkthrough.html">Walkthrough of waiting list functions</a></li>
    <li><a class="dropdown-item" href="../articles/three_example_waiting_lists.html">Three example waiting lists</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Walkthrough of waiting list functions</h1>
            
      

      <div class="d-none name"><code>example_walkthrough.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-r-community.github.io/NHSRwaitinglist/">NHSRwaitinglist</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette is a practical demonstration of the {NHSRwaitinglist}
functions, using the same running example that is used in the reference
white paper <a href="https://www.medrxiv.org/content/10.1101/2022.08.23.22279117v1.full-text" class="external-link">Fong
el al.</a>, and <a href="https://www.youtube.com/watch?v=NWthhW5Fgls" class="external-link">video</a>.</p>
<p>The example is centred on a P4 (priority 4) Ear, Nose &amp; Throat
(ENT) waiting list at an acute hospital.</p>
<p>The package functions we will be using are:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th align="right">Function</th>
<th align="left">Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right"><code><a href="../reference/calc_queue_load.html">calc_queue_load()</a></code></td>
<td align="left">To understand the ratio between demand and
capacity.</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/calc_target_mean_wait.html">calc_target_mean_wait()</a></code></td>
<td align="left">To understand the average waiting time for a queue in
equilibrium.</td>
</tr>
<tr class="odd">
<td align="right"><code><a href="../reference/calc_target_queue_size.html">calc_target_queue_size()</a></code></td>
<td align="left">To understand the queue size for a queue in
equilibrium.</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/calc_relief_capacity.html">calc_relief_capacity()</a></code></td>
<td align="left">To calculate the relief capacity needed to bring a very
large queue under control.</td>
</tr>
<tr class="odd">
<td align="right"><code><a href="../reference/calc_target_capacity.html">calc_target_capacity()</a></code></td>
<td align="left">To understand the capacity required to keep a queue in
equilibrium, depending on how much variability it experiences.</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/calc_waiting_list_pressure.html">calc_waiting_list_pressure()</a></code></td>
<td align="left">A pressure measure, which can be used to compare
multiple waiting lists for planning purposes.</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, we’ll add the initial data we need, taken from the white
paper.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Queue size (patients)</span></span>
<span><span class="va">queue_size</span> <span class="op">&lt;-</span> <span class="fl">1200</span></span>
<span></span>
<span><span class="co"># Waiting time target (weeks)</span></span>
<span><span class="va">waiting_time_target</span> <span class="op">&lt;-</span> <span class="fl">52</span></span>
<span></span>
<span><span class="co"># Average waiting time in the queue (weeks)</span></span>
<span><span class="va">avg_waiting_time</span> <span class="op">&lt;-</span> <span class="fl">63</span></span>
<span></span>
<span><span class="co"># Proportion of waiting list who have missed the 52 week target (%)</span></span>
<span><span class="va">perc_missing_target</span> <span class="op">&lt;-</span> <span class="fl">0.51</span></span>
<span></span>
<span><span class="co"># Demand (patients per week)</span></span>
<span><span class="va">demand</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="co"># Capacity (procedures per week)</span></span>
<span><span class="va">capacity</span> <span class="op">&lt;-</span> <span class="fl">27</span></span>
<span></span>
<span><span class="co"># Standard deviation of number of operations per week</span></span>
<span><span class="va">std_dev_procedures</span> <span class="op">&lt;-</span> <span class="fl">160</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="demand-capacity-and-load">Demand, capacity, and load<a class="anchor" aria-label="anchor" href="#demand-capacity-and-load"></a>
</h2>
<blockquote>
<p>Fact 1: Capacity must be larger than demand, otherwise the waiting
list size will grow indefinitely.</p>
</blockquote>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">load</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_queue_load.html">calc_queue_load</a></span><span class="op">(</span><span class="va">demand</span>, <span class="va">capacity</span><span class="op">)</span></span>
<span><span class="va">load</span></span>
<span><span class="co">#&gt; [1] 1.111111</span></span></code></pre></div>
<p>We see that the load is 1.11, which is greater than 1. The queue will
therefore grow in size indefinitely.</p>
<blockquote>
<p>Fact 2: If the load is greater than 1, then the queue is unstable,
and the waiting list will grow indefinitely. If the load is less than 1,
then the queue will be stable and the load is the proportion of the time
that that waiting list is non-empty.</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="waiting-list-targets">Waiting list targets<a class="anchor" aria-label="anchor" href="#waiting-list-targets"></a>
</h2>
<blockquote>
<p>Fact 3: If the load on a queue is less than 1 then the chance of
missing the target halves each time we increase the target by some fixed
number of days.</p>
</blockquote>
<blockquote>
<p>Fact 4: If we want to have a chance between 1.8%-0.2% of not
achieving a waiting time target, then the average patient should have a
waiting time between a quarter and a sixth of the target.</p>
</blockquote>
<p>In the case of a P4 waiting list, the target wait is 52 weeks. Thus,
we should expect the average patient being operated on to have waited
between 9 and 13 weeks. In the case of P2 customers, the target is 4
weeks. Thus, the mean wait of a typical patient should be under one
week.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_mean_wait</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_target_mean_wait.html">calc_target_mean_wait</a></span><span class="op">(</span><span class="va">waiting_time_target</span><span class="op">)</span></span>
<span><span class="va">target_mean_wait</span></span>
<span><span class="co">#&gt; [1] 13</span></span></code></pre></div>
<p>We see that the target mean wait is 13 weeks.</p>
</div>
<div class="section level2">
<h2 id="target-queue-length">Target queue length<a class="anchor" aria-label="anchor" href="#target-queue-length"></a>
</h2>
<blockquote>
<p>Fact 5: Little’s Law. Assuming capacity exceeds demand, the average
queue size is demand multiplied by average waiting time.</p>
</blockquote>
<p>If, as given in Fact 4 above, we want the average waiting time to be
a quarter of the target, then Little’s Law leads to fact 6.</p>
</div>
<div class="section level2">
<h2 id="target-queue-size">Target queue size<a class="anchor" aria-label="anchor" href="#target-queue-size"></a>
</h2>
<blockquote>
<p>Fact 6: Target queue size is demand multiplied by target wait,
divided by 4.</p>
</blockquote>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_queue_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_target_queue_size.html">calc_target_queue_size</a></span><span class="op">(</span><span class="va">demand</span>, <span class="va">waiting_time_target</span><span class="op">)</span></span>
<span><span class="va">target_queue_size</span></span>
<span><span class="co">#&gt; [1] 390</span></span>
<span></span>
<span><span class="va">queue_ratio</span> <span class="op">&lt;-</span> <span class="va">queue_size</span> <span class="op">/</span> <span class="va">target_queue_size</span></span>
<span><span class="va">queue_ratio</span></span>
<span><span class="co">#&gt; [1] 3.076923</span></span></code></pre></div>
<p>In this example, the target queue size is 390, and the actual queue
is 1200. The queue ratio is 3.1, meaning that the queue is 3.1 times its
target size.</p>
<p>If the waiting list size is over twice the target queue size, then we
consider that special measures are needed to increase capacity, and
reduce waiting list size.</p>
</div>
<div class="section level2">
<h2 id="relief-capacity">Relief capacity<a class="anchor" aria-label="anchor" href="#relief-capacity"></a>
</h2>
<blockquote>
<p>Fact 7: If the actual queue size is more than double the target queue
size, then decide on a target date by which the queue will be brought
down, and apply the necessary relief capacity.</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weeks_until_target_acheived</span> <span class="op">&lt;-</span> <span class="fl">26</span></span>
<span></span>
<span><span class="va">relief_capacity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_relief_capacity.html">calc_relief_capacity</a></span><span class="op">(</span></span>
<span>  demand <span class="op">=</span> <span class="va">demand</span>,</span>
<span>  queue_size <span class="op">=</span> <span class="va">queue_size</span>,</span>
<span>  target_queue_size <span class="op">=</span> <span class="va">target_queue_size</span>,</span>
<span>  time_to_target <span class="op">=</span> <span class="va">weeks_until_target_acheived</span></span>
<span><span class="op">)</span></span>
<span><span class="va">relief_capacity</span></span>
<span><span class="co">#&gt; [1] 61.15385</span></span></code></pre></div>
<p>In this example, we decide that the target should be achieved by the
start of the summer, 26 weeks away. To do this, the capacity needed is
61.2 procedures per week, compared to 27 procedures per week currently
being performed.</p>
</div>
<div class="section level2">
<h2 id="target-capacity">Target capacity<a class="anchor" aria-label="anchor" href="#target-capacity"></a>
</h2>
<p>As discussed above if the queue size is more than double its target
then capacity should be increased temporarily. However, once the queue
size is within an acceptable range, we can maintain the waiting time
target with what is potentially a much smaller capacity allocation to
the waiting list.</p>
<p>We know the mean waiting time (13 weeks) and queue size (390
patients) of a waiting list operating at its target equilibrium. Now we
calculate a capacity allocation that will maintain this equilibrium in
the long run.</p>
<blockquote>
<p>Fact 8: Target capacity formula, based on the Pollaczek-Khinchine
formula. The target capacity depends on demand, plus an additional
capacity which is based on service variability, and the waiting time
target.</p>
</blockquote>
<p>The parameter “F” depends on the variability of the service. If we do
not know F, we can assume F = 1. Values less than 1 are good. Higher
values represent more variability, which in turn will increase the
capacity required to maintain equilibrium.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set the "F" variability parameter</span></span>
<span><span class="va">f_1</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">target_capacity_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_target_capacity.html">calc_target_capacity</a></span><span class="op">(</span></span>
<span>  demand <span class="op">=</span> <span class="va">demand</span>,</span>
<span>  target_wait <span class="op">=</span> <span class="va">waiting_time_target</span></span>
<span><span class="op">)</span></span>
<span><span class="va">target_capacity_1</span></span>
<span><span class="co">#&gt; [1] 30.07692</span></span></code></pre></div>
<p>If F is 1, we can see that the capacity required is 30.08, or 0.08
more than the demand.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_2</span> <span class="op">&lt;-</span> <span class="fl">6.58</span></span>
<span></span>
<span><span class="va">target_capacity_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_target_capacity.html">calc_target_capacity</a></span><span class="op">(</span></span>
<span>  demand <span class="op">=</span> <span class="va">demand</span>,</span>
<span>  target_wait <span class="op">=</span> <span class="va">waiting_time_target</span></span>
<span><span class="op">)</span></span>
<span><span class="va">target_capacity_2</span></span>
<span><span class="co">#&gt; [1] 30.07692</span></span></code></pre></div>
<p>If F is 6.58, we can see that the capacity required is 30.08, or 0.08
more than the demand.</p>
<p>So, decreasing variability of service (for example by stabilising
operating theatre schedules from day to day and week to week) has the
effect of reducing the capacity required to achieve a given service
waiting standard.</p>
<!--TODO add a calculation example for "F" here when the function is written-->
</div>
<div class="section level2">
<h2 id="waiting-list-pressure">Waiting list pressure<a class="anchor" aria-label="anchor" href="#waiting-list-pressure"></a>
</h2>
<blockquote>
<p>Fact 9: Waiting list pressure. For a waiting list with target waiting
time, the pressure on the waiting list is twice the mean waiting time
divided by the target waiting time. The pressure of any given waiting
list should be less than 1. If the pressure is greater than 1 then the
waiting list is most likely going to miss its target.</p>
</blockquote>
<!--TODO check the 2x factor in this equation.  Pressure should be less than 1, but the examples omit the 2x factor.  Should pressure be less than 0.5, 1, or 2?-->
<p>Measuring waiting list pressure can give a comparative measure with
which to compare waiting lists, and help make resource allocation
decisions.</p>
<p>For the P4 ENT example we have been following:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">waiting_list_pressure_p4</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/calc_waiting_list_pressure.html">calc_waiting_list_pressure</a></span><span class="op">(</span></span>
<span>    <span class="va">avg_waiting_time</span>,</span>
<span>    <span class="va">waiting_time_target</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">waiting_list_pressure_p4</span></span>
<span><span class="co">#&gt; [1] 2.423077</span></span></code></pre></div>
<p>The queue size is large, with 1200 patients waiting. The waiting time
target is 52 weeks, and the average waiting time being experienced is 63
weeks. This gives a waiting list pressure of 2.42. <strong>NOTE</strong>
these numbers are slightly different to the <a href="https://www.medrxiv.org/content/10.1101/2022.08.23.22279117v1.full-text" class="external-link">white
paper</a>, which changes the average waiting time from 63 weeks to 61
weeks during the example.</p>
<p>If we look at the P2 ENT example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">queue_size_p2</span> <span class="op">&lt;-</span> <span class="fl">220</span></span>
<span><span class="va">avg_waiting_time_p2</span> <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span><span class="va">waiting_time_target_p2</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span></span>
<span><span class="va">waiting_list_pressure_p2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/calc_waiting_list_pressure.html">calc_waiting_list_pressure</a></span><span class="op">(</span></span>
<span>    <span class="va">avg_waiting_time_p2</span>,</span>
<span>    <span class="va">waiting_time_target_p2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">waiting_list_pressure_p2</span></span>
<span><span class="co">#&gt; [1] 12</span></span></code></pre></div>
<p>The queue size is smaller, with 220 patients waiting. The waiting
time target is 4 weeks, and the average waiting time being experienced
is 24. This gives a waiting list pressure of 12.</p>
<p>In these two examples the pressure on the much shorter P2 waiting
list is 5 times higher than that on the P4 list. Closer attention should
be paid to P2 procedures.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This worked example aims to demonstrate the functions available in
this package. In chronological order of application they were:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr class="header">
<th align="right">Function</th>
<th align="left">Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right"><code><a href="../reference/calc_queue_load.html">calc_queue_load()</a></code></td>
<td align="left">To understand the ratio between demand and
capacity.</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/calc_target_mean_wait.html">calc_target_mean_wait()</a></code></td>
<td align="left">To understand the average waiting time for a queue in
equilibrium.</td>
</tr>
<tr class="odd">
<td align="right"><code><a href="../reference/calc_target_queue_size.html">calc_target_queue_size()</a></code></td>
<td align="left">To understand the queue size for a queue in
equilibrium.</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/calc_relief_capacity.html">calc_relief_capacity()</a></code></td>
<td align="left">To calculate the relief capacity needed to bring a very
large queue under control.</td>
</tr>
<tr class="odd">
<td align="right"><code><a href="../reference/calc_target_capacity.html">calc_target_capacity()</a></code></td>
<td align="left">To understand the capacity required to keep a queue in
equilibrium, depending on how much variability it experiences.</td>
</tr>
<tr class="even">
<td align="right"><code><a href="../reference/calc_waiting_list_pressure.html">calc_waiting_list_pressure()</a></code></td>
<td align="left">A pressure measure, which can be used to compare
multiple waiting lists for planning purposes.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>For examples of practical applications, and other considerations, see
the helpful “Case Studies” section towards the end of the <a href="https://www.medrxiv.org/content/10.1101/2022.08.23.22279117v1.full-text" class="external-link">white
paper</a>.</p>
<p>END</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Neil Walton, Matt Dray, Tom Smith, Chris Mainey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
