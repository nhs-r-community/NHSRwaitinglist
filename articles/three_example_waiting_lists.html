<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Three example waiting lists • NHSRwaitinglist</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Three example waiting lists">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NHSRwaitinglist</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example_walkthrough.html">Walkthrough of waiting list functions</a></li>
    <li><a class="dropdown-item" href="../articles/three_example_waiting_lists.html">Three example waiting lists</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Three example waiting lists</h1>
            
      

      <div class="d-none name"><code>three_example_waiting_lists.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nhs-r-community.github.io/NHSRwaitinglist/">NHSRwaitinglist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set a seed so that these plots are always the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>This vignette is a set of worked examples using a sample dataset
similar to that which you may be working with. It also demonstrates how
to use the <code>wl_*</code> family of functions, such as
<code>wl_simulator</code>, <code>wl_queue_size</code>,
<code>wl_referral_stats</code>, <code>wl_removal_stats</code>, and
<code>wl_stats</code>.</p>
<div class="section level2">
<h2 id="anatomy-of-a-waiting-list">Anatomy of a waiting list<a class="anchor" aria-label="anchor" href="#anatomy-of-a-waiting-list"></a>
</h2>
<p>In its purest form, a waiting list consists of the dates that
individuals arrived in a queue, and the dates that they left having been
seen by the service (doctor, nurse, or diagnostic test, and so on).
These dates are the waiting list additions (or arrivals, referrals), and
waiting list removals (or treatments, discharges). They correspond to
demand (for arrivals), and capacity (for removals).</p>
<p>This vignette is going to simulate 3 different waiting lists:</p>
<ol style="list-style-type: decimal">
<li><a href="#one">A list where demand is higher than capacity</a></li>
<li><a href="#two">A list where demand and capacity are similar</a></li>
<li><a href="#three">A list where there is sufficient capacity for the
demand</a></li>
</ol>
</div>
<div class="section level2">
<h2 id="one">1. A growing waiting list<a class="anchor" aria-label="anchor" href="#one"></a>
</h2>
<p><a href="#">Back to top…</a></p>
<p>So first we need a waiting list, and we can make a synthetic one
using the <code><a href="../reference/wl_simulator.html">wl_simulator()</a></code> function. We decide how long our
simulation should run for, and what our weekly demand and capacity is.
In the example below the capacity is less than the demand, so over time
we should expect a queue to form.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">waiting_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_simulator.html">wl_simulator</a></span><span class="op">(</span></span>
<span>  start_date <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2024-03-31"</span>,</span>
<span>  demand <span class="op">=</span> <span class="fl">10</span>, <span class="co"># simulating 10 patient arrivals per week</span></span>
<span>  capacity <span class="op">=</span> <span class="fl">9</span> <span class="co"># simulating 9 patients being treated per week</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">waiting_list</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Referral    Removal</span></span>
<span><span class="co">#&gt; 1  2020-01-02 2020-01-03</span></span>
<span><span class="co">#&gt; 2  2020-01-03 2020-01-04</span></span>
<span><span class="co">#&gt; 3  2020-01-04 2020-01-05</span></span>
<span><span class="co">#&gt; 4  2020-01-04 2020-01-05</span></span>
<span><span class="co">#&gt; 5  2020-01-06 2020-01-07</span></span>
<span><span class="co">#&gt; 6  2020-01-08 2020-01-09</span></span>
<span><span class="co">#&gt; 7  2020-01-08 2020-01-10</span></span>
<span><span class="co">#&gt; 8  2020-01-08 2020-01-11</span></span>
<span><span class="co">#&gt; 9  2020-01-09 2020-01-12</span></span>
<span><span class="co">#&gt; 10 2020-01-09 2020-01-12</span></span></code></pre></div>
<p>Now that we have a waiting list, we should visualise it. We can use
the <code><a href="../reference/wl_queue_size.html">wl_queue_size()</a></code> function to tell us the size of the
queue at the end of each day. We can use {ggplot} to make a plot of the
queue size over time, and as expected, it gets larger and larger because
our demand is bigger than our capacity.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate the queue size</span></span>
<span><span class="va">queue_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_queue_size.html">wl_queue_size</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">queue_size</span><span class="op">)</span></span>
<span><span class="co">#&gt;        dates queue_size</span></span>
<span><span class="co">#&gt; 1 2020-01-02          1</span></span>
<span><span class="co">#&gt; 2 2020-01-03          1</span></span>
<span><span class="co">#&gt; 3 2020-01-04          2</span></span>
<span><span class="co">#&gt; 4 2020-01-05          0</span></span>
<span><span class="co">#&gt; 5 2020-01-06          1</span></span>
<span><span class="co">#&gt; 6 2020-01-07          0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">queue_size</span><span class="op">)</span></span>
<span><span class="co">#&gt;           dates queue_size</span></span>
<span><span class="co">#&gt; 1546 2024-03-26        182</span></span>
<span><span class="co">#&gt; 1547 2024-03-27        181</span></span>
<span><span class="co">#&gt; 1548 2024-03-28        183</span></span>
<span><span class="co">#&gt; 1549 2024-03-29        185</span></span>
<span><span class="co">#&gt; 1550 2024-03-30        184</span></span>
<span><span class="co">#&gt; 1551 2024-03-31        185</span></span>
<span></span>
<span><span class="co"># visualise the queue with a plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">queue_size</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">dates</span>, <span class="va">queue_size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"A growing waiting list"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="three_example_waiting_lists_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
<div class="section level3">
<h3 id="referral-statistics">Referral statistics<a class="anchor" aria-label="anchor" href="#referral-statistics"></a>
</h3>
<p>Next, we might be interested in some statistics about the referrals,
or arrivals, to the queue. We can use the
<code><a href="../reference/wl_referral_stats.html">wl_referral_stats()</a></code> function to calculate these.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">referral_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_referral_stats.html">wl_referral_stats</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">referral_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   demand_weekly demand_daily demand_cov demand_count</span></span>
<span><span class="co">#&gt; 1      9.818065     1.402581   1.131775         2174</span></span></code></pre></div>
<p>Now we can see that 2174 patients joined our simulated waiting list,
at an average rate of 9.82 per week, or 1.4 per day. Very close to the
10 patients a week we requested when we made our simulated waiting list
using <code><a href="../reference/wl_simulator.html">wl_simulator()</a></code>. The final statistic of interest is
the coefficient of variation, which is 1.13.</p>
</div>
<div class="section level3">
<h3 id="removal-statistics">Removal statistics<a class="anchor" aria-label="anchor" href="#removal-statistics"></a>
</h3>
<p>Similarly, we might be interested in some statistics about the
removals from the queue. We can use the <code><a href="../reference/wl_removal_stats.html">wl_removal_stats()</a></code>
function to calculate these.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">removal_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_removal_stats.html">wl_removal_stats</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">removal_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   capacity_weekly capacity_daily capacity_cov removal_count</span></span>
<span><span class="co">#&gt; 1        9.001294       1.285899    0.5363836          1988</span></span></code></pre></div>
<p>Now we can see that 1988 patients were treated and removed from our
simulated waiting list, at an average rate of 9 per week, or 1.29 per
day. Very close to the 9 patients a week we set up using
<code><a href="../reference/wl_simulator.html">wl_simulator()</a></code>. The final statistic of interest is the
coefficient of variation (for removals), which is 0.54.</p>
</div>
<div class="section level3">
<h3 id="overall-stats">Overall stats<a class="anchor" aria-label="anchor" href="#overall-stats"></a>
</h3>
<p>Finally, we can calculate a combined set of statistics to summarise
the waiting list. To do this we need to provide the target waiting time.
This might be 2 weeks for a cancer referral, or commonly 18 weeks for a
standard non-cancer referral.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overall_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_stats.html">wl_stats</a></span><span class="op">(</span></span>
<span>  waiting_list <span class="op">=</span> <span class="va">waiting_list</span>,</span>
<span>  target_wait <span class="op">=</span> <span class="fl">18</span> <span class="co"># standard NHS 18 weeks target</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">overall_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mean_demand mean_capacity     load load_too_big count_demand queue_size</span></span>
<span><span class="co">#&gt; 1    9.818065      9.001294 1.090739         TRUE         2174        185</span></span>
<span><span class="co">#&gt;   target_queue_size queue_too_big mean_wait cv_arrival cv_removal</span></span>
<span><span class="co">#&gt; 1          44.18129          TRUE  64.63784   1.131775  0.5363836</span></span>
<span><span class="co">#&gt;   target_capacity relief_capacity pressure</span></span>
<span><span class="co">#&gt; 1              NA        15.23417 7.181982</span></span></code></pre></div>
<p>This gives us a lot of useful information. Taking it step by
step:</p>
<p>The first 4 columns tell us whether the load is larger than 1. If it
is, we can expect the queue to continue growing indefinitely.</p>
<table class="table">
<thead><tr class="header">
<th align="center">mean_demand</th>
<th align="center">mean_capacity</th>
<th align="center">load</th>
<th align="center">load_too_big</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">9.818065</td>
<td align="center">9.001294</td>
<td align="center">1.090739</td>
<td align="center">TRUE</td>
</tr></tbody>
</table>
<p>The next columns tell us about the resulting queue size at the end of
our simulation, the target size we need to plan for in order to achieve
the 18 week waiting target, and a judgement about whether the queue is
too large. If the queue is too large, we need to implement some relief
capacity to bring it within range before attempting to maintain the
queue.</p>
<table class="table">
<thead><tr class="header">
<th align="center">queue_size</th>
<th align="center">target_queue_size</th>
<th align="center">queue_too_big</th>
<th align="center">mean_wait</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">185</td>
<td align="center">44.18129</td>
<td align="center">TRUE</td>
<td align="center">64.63784</td>
</tr></tbody>
</table>
<p>There is a column to report the actual average patient waiting time,
which is 64.64 weeks, compared to our target of 18 weeks.</p>
<table class="table">
<thead><tr class="header">
<th align="center">mean_wait</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">64.63784</td>
</tr></tbody>
</table>
<p>These two columns re-state the coefficients of variance for use in
reporting.</p>
<table class="table">
<thead><tr class="header">
<th align="center">cv_arrival</th>
<th align="center">cv_removal</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">1.131775</td>
<td align="center">0.5363836</td>
</tr></tbody>
</table>
<p>The next two columns tell us about the required capacity. Only one
will contain data.</p>
<ol style="list-style-type: decimal">
<li>If the queue is not too large, <code>"target_capacity"</code> will
report the capacity required to maintain the queue at it’s target
waiting time performance.</li>
<li>If the queue is too large, <code>"relief_capacity"</code> will
report the capacity required to bring the queue to a maintainable size
within 26 weeks (6 months).</li>
</ol>
<table class="table">
<thead><tr class="header">
<th align="center">target_capacity</th>
<th align="center">relief_capacity</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">NA</td>
<td align="center">15.23417</td>
</tr></tbody>
</table>
<p>The final column reports the waiting list <code>"pressure"</code>.
This will be useful later when comparing waiting lists of differing
sizes, with differing targets. It allows waiting list pressures to be
compared because the waiting list with the largest number of patients
waiting is not always the list with the largest problem meeting its
target.</p>
<table class="table">
<thead><tr class="header">
<th align="center">pressure</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">7.181982</td>
</tr></tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="two">2. A finely balanced waiting list<a class="anchor" aria-label="anchor" href="#two"></a>
</h2>
<p><a href="#">Back to top…</a></p>
<p>The waiting list in this section is very finely balanced. The demand
remains the same as the last example, but now capacity has been
increased to be slightly larger than demand. It is not significantly
larger (there is approximately 2% <code>"spare"</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">waiting_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_simulator.html">wl_simulator</a></span><span class="op">(</span></span>
<span>  start_date <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2024-03-31"</span>,</span>
<span>  demand <span class="op">=</span> <span class="fl">10</span>, <span class="co"># simulating 10 patient arrivals per week</span></span>
<span>  capacity <span class="op">=</span> <span class="fl">10.2</span> <span class="co"># simulating 10.2 patients being treated per week</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">referral_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_referral_stats.html">wl_referral_stats</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">referral_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   demand_weekly demand_daily demand_cov demand_count</span></span>
<span><span class="co">#&gt; 1      10.10458     1.443512   1.153809         2236</span></span>
<span></span>
<span><span class="va">removal_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_removal_stats.html">wl_removal_stats</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">removal_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   capacity_weekly capacity_daily capacity_cov removal_count</span></span>
<span><span class="co">#&gt; 1        10.12941       1.447059    0.6896719          2214</span></span>
<span></span>
<span><span class="co"># calculate the queue size</span></span>
<span><span class="va">queue_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_queue_size.html">wl_queue_size</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span></code></pre></div>
<p>This time we processed 2214 patients.</p>
<p>The increase in capacity not only allowed processing more patients,
it also changed the shape of the queue. Visualising the queue we can see
that this time it did not grow uncontrollably, reaching a maximum size
of 35 patients waiting over the same time period as the first
simulation. It also returned to zero length several times during the
simulated period.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise the queue with a plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">queue_size</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">dates</span>, <span class="va">queue_size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"A finely-balanced waiting list"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="three_example_waiting_lists_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>This time we will go straight to calculating the overall
statistics.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overall_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_stats.html">wl_stats</a></span><span class="op">(</span></span>
<span>  waiting_list <span class="op">=</span> <span class="va">waiting_list</span>,</span>
<span>  target_wait <span class="op">=</span> <span class="fl">18</span> <span class="co"># standard NHS 18wk target</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">overall_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mean_demand mean_capacity      load load_too_big count_demand queue_size</span></span>
<span><span class="co">#&gt; 1    10.10458      10.12941 0.9975489        FALSE         2236         22</span></span>
<span><span class="co">#&gt;   target_queue_size queue_too_big mean_wait cv_arrival cv_removal</span></span>
<span><span class="co">#&gt; 1          45.47063         FALSE  6.863636   1.153809  0.6896719</span></span>
<span><span class="co">#&gt;   target_capacity relief_capacity  pressure</span></span>
<span><span class="co">#&gt; 1        10.30535              NA 0.7626263</span></span></code></pre></div>
<p>In this finely balanced example, the mean demand and mean capacity
give a load very close to 1, at 0.9975. While this is less than one, it
is perhaps a little too close for comfort.</p>
<p>We can see that the finishing queue size is 22, but as discussed
above, the waiting list fluctuated in size, and even returned to zero a
couple of times during the simulated period. It has not grown
uncontrollably as in the first example.</p>
<p>The mean wait is 6.86, which is less than the target of 18 weeks, but
is more than a quarter of the target. The exponential shape of waiting
list distributions means that in this system we would expect more than a
reasonable number of patients to be experiencing waiting times of over
18 weeks.</p>
<p>This time, we do not need relief capacity because the queue is not
too big. Instead, the package recommends a
<code>"target capacity"</code>, which we need to provide if we want to
meet the 18 week standard for the right proportion of patients. In this
case it is 10.305, which is only very marginally larger than the mean
capacity we have available (10.129).</p>
</div>
<div class="section level2">
<h2 id="three">3. A waiting list with sufficient capacity<a class="anchor" aria-label="anchor" href="#three"></a>
</h2>
<p><a href="#">Back to top…</a></p>
<p>The final example is for a waiting list with sufficient capacity to
meet demand. We’ll use the recommended figure from the example above,
assuming we have made some improvements and increased available capacity
from 10.2 to 10.3 patients per week.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">waiting_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_simulator.html">wl_simulator</a></span><span class="op">(</span></span>
<span>  start_date <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2024-03-31"</span>,</span>
<span>  demand <span class="op">=</span> <span class="fl">10</span>, <span class="co"># simulating 10 patient arrivals per week</span></span>
<span>  capacity <span class="op">=</span> <span class="fl">10.3</span> <span class="co"># simulating 10.3 patients being treated per week</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">referral_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_referral_stats.html">wl_referral_stats</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">referral_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   demand_weekly demand_daily demand_cov demand_count</span></span>
<span><span class="co">#&gt; 1      9.698904     1.385558   1.173034         2149</span></span>
<span></span>
<span><span class="va">removal_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_removal_stats.html">wl_removal_stats</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">removal_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   capacity_weekly capacity_daily capacity_cov removal_count</span></span>
<span><span class="co">#&gt; 1        10.14005       1.448579    0.7247564          2141</span></span>
<span></span>
<span><span class="co"># calculate the queue size</span></span>
<span><span class="va">queue_size</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_queue_size.html">wl_queue_size</a></span><span class="op">(</span><span class="va">waiting_list</span><span class="op">)</span></span></code></pre></div>
<p>This time we processed 2141 patients.<br>
Visualising the queue, again it looks different to the previous
examples. While the maximum number of patients in the queue is similar
to the last example, this time the queue size has frequently dropped to
zero. This is a stable queue, which is able to empty more regularly.</p>
<p><strong>NOTE</strong> When the queue is empty, the process serving it
will also be idle. Conventional wisdom has it that at this point the
process must have excess capacity, which can safely be removed. This is
<strong>not</strong> the case. Returning to “Fact 2” of <a href="https://www.medrxiv.org/content/10.1101/2022.08.23.22279117v1.full" class="external-link">Professor
Neil Walton’s white paper</a>,</p>
<blockquote>
<p>If you want to have low waiting times, then there must be a
non-negligible fraction of time where services are not being used.</p>
</blockquote>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise the queue with a plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">queue_size</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">dates</span>, <span class="va">queue_size</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"A stable waiting list"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="three_example_waiting_lists_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p>Again calculating the overall statistics.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">overall_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_stats.html">wl_stats</a></span><span class="op">(</span></span>
<span>  waiting_list <span class="op">=</span> <span class="va">waiting_list</span>,</span>
<span>  target_wait <span class="op">=</span> <span class="fl">18</span> <span class="co"># standard NHS 18 weeks target</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">overall_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mean_demand mean_capacity      load load_too_big count_demand queue_size</span></span>
<span><span class="co">#&gt; 1    9.698904      10.14005 0.9564943        FALSE         2149          7</span></span>
<span><span class="co">#&gt;   target_queue_size queue_too_big mean_wait cv_arrival cv_removal</span></span>
<span><span class="co">#&gt; 1          43.64507         FALSE 0.8571429   1.173034  0.7247564</span></span>
<span><span class="co">#&gt;   target_capacity relief_capacity  pressure</span></span>
<span><span class="co">#&gt; 1        9.910157              NA 0.0952381</span></span></code></pre></div>
<p>This time the simulation has created a mean demand and capacity which
is slightly lower than we asked for, but the gap between them is similar
to what we wanted.</p>
<p>The load comes out at 0.956, which is more comfortably below one. A
still lower load would give more headroom, and may even become necessary
if the variability of demand or capacity were to increase.</p>
<p>The mean wait is 0.86, less than a week, which is very comfortably
less than the target of 18 weeks. In this system we expect the 18 weeks
target to be met for the vast majority of patients.</p>
<p>Again, the package is recommending a <code>"target capacity"</code>,
this time of 9.91, which is a similar margin above the mean demand for
this simulation (9.699).</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p><a href="#">Back to top…</a></p>
<p>This vignette has detailed some of the <code>wl_*</code> functions
you can use to explore your waiting list performance. We also saw how
altering service capacity without changing demand can have a dramatic
effect on the behaviour of a waiting list.</p>
<hr>
<p>END</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Neil Walton, Matt Dray, Tom Smith, Chris Mainey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
